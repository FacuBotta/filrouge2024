(()=>{var e={};e.id=654,e.ids=[654],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79646:e=>{"use strict";e.exports=require("child_process")},55511:e=>{"use strict";e.exports=require("crypto")},14985:e=>{"use strict";e.exports=require("dns")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},91645:e=>{"use strict";e.exports=require("net")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},27910:e=>{"use strict";e.exports=require("stream")},34631:e=>{"use strict";e.exports=require("tls")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},4573:e=>{"use strict";e.exports=require("node:buffer")},77598:e=>{"use strict";e.exports=require("node:crypto")},57975:e=>{"use strict";e.exports=require("node:util")},84144:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var t=s(70260),o=s(28203),a=s(25155),i=s.n(a),n=s(67292),l={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(r,l);let c=["",{children:["messages",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,40534)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\messages\\new\\page.tsx"]}]},{}]},{}],auth:["__DEFAULT__",{},{defaultPage:[()=>Promise.resolve().then(s.bind(s,91985)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\@auth\\default.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,1033)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,89977)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\not-found.tsx"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,41485,23)),"next/dist/client/components/unauthorized-error"]}],d=["C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\messages\\new\\page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:o.RouteKind.APP_PAGE,page:"/messages/new/page",pathname:"/messages/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},14817:(e,r,s)=>{"use strict";s.r(r),s.d(r,{"7fe13f6264349238c6e48141c1e4a57ee047053936":()=>t.Y});var t=s(53337)},66594:(e,r,s)=>{"use strict";s.r(r),s.d(r,{"40a45ea36b9f590f5279bf88e972aa253d9f1e05a7":()=>t.c});var t=s(40770)},63438:(e,r,s)=>{Promise.resolve().then(s.bind(s,45025))},3190:(e,r,s)=>{Promise.resolve().then(s.bind(s,83436))},83436:(e,r,s)=>{"use strict";s.d(r,{NewMessagePage:()=>h});var t=s(45512),o=s(26248);let a=(0,o.createServerReference)("40a45ea36b9f590f5279bf88e972aa253d9f1e05a7",o.callServer,void 0,o.findSourceMapURL,"createConversation");var i=s(20124),n=s(24109),l=s(8089);let c=({className:e})=>(0,t.jsxs)("svg",{className:e,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsxs)("g",{id:"DefaultUserAvatar",clipPath:"url(#clip0_388_43)",children:[(0,t.jsx)("path",{id:"border",d:"M1 10C1 11.1819 1.23279 12.3522 1.68508 13.4442C2.13738 14.5361 2.80031 15.5282 3.63604 16.364C4.47177 17.1997 5.46392 17.8626 6.55585 18.3149C7.64778 18.7672 8.8181 19 10 19C11.1819 19 12.3522 18.7672 13.4442 18.3149C14.5361 17.8626 15.5282 17.1997 16.364 16.364C17.1997 15.5282 17.8626 14.5361 18.3149 13.4442C18.7672 12.3522 19 11.1819 19 10C19 8.8181 18.7672 7.64778 18.3149 6.55585C17.8626 5.46392 17.1997 4.47177 16.364 3.63604C15.5282 2.80031 14.5361 2.13738 13.4442 1.68508C12.3522 1.23279 11.1819 1 10 1C8.8181 1 7.64778 1.23279 6.55585 1.68508C5.46392 2.13738 4.47177 2.80031 3.63604 3.63604C2.80031 4.47177 2.13738 5.46392 1.68508 6.55585C1.23279 7.64778 1 8.8181 1 10Z",stroke:"black",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsxs)("g",{id:"filled",children:[(0,t.jsx)("path",{id:"Vector",d:"M7 8C7 8.79565 7.31607 9.55871 7.87868 10.1213C8.44129 10.6839 9.20435 11 10 11C10.7956 11 11.5587 10.6839 12.1213 10.1213C12.6839 9.55871 13 8.79565 13 8C13 7.20435 12.6839 6.44129 12.1213 5.87868C11.5587 5.31607 10.7956 5 10 5C9.20435 5 8.44129 5.31607 7.87868 5.87868C7.31607 6.44129 7 7.20435 7 8Z",fill:"black",stroke:"black",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsxs)("g",{id:"Vector_2",children:[(0,t.jsx)("path",{d:"M6 18C6.25459 16.8459 4.77555 15.8258 5.48559 15.1068C6.19563 14.3878 7.05692 13.9996 7.9417 14H12.0562C12.9421 13.9996 13.8045 14.3886 14.515 15.1093C15.2256 15.83 13.7464 16.8438 14 18",fill:"black"}),(0,t.jsx)("path",{d:"M6 18C6.25459 16.8459 4.77555 15.8258 5.48559 15.1068C6.19563 14.3878 7.05692 13.9996 7.9417 14H12.0562C12.9421 13.9996 13.8045 14.3886 14.515 15.1093C15.2256 15.83 13.7464 16.8438 14 18",stroke:"black",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})]})]}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0_388_43",children:(0,t.jsx)("rect",{width:"20",height:"20",fill:"white"})})})]});var d=s(55852),u=s(99318),p=s(79334),v=s(58009),x=s(91542);let h=({users:e})=>{let[r,s]=(0,v.useState)([]),o=(0,p.useRouter)(),h=async e=>{e.preventDefault();let s={sujet:new FormData(e.currentTarget).get("sujet"),participantsId:r},t=await a(s);t?.ok?(x.o.success(t.message),o.push("/messages")):(console.error(t),x.o.error(t.message))},g=e=>{s(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])};return(0,t.jsx)(i.default,{children:(0,t.jsxs)("div",{className:"w-full max-w-[400px] h-fit max-h-[600px] flex flex-col gap-2 p-4 mx-2 bg-light-blue dark:bg-dark-bg rounded-xl",children:[(0,t.jsx)(u.Link,{href:"/messages",children:(0,t.jsx)(l.default,{type:"plus",strokeWidth:2,className:"transform rotate-45"})}),(0,t.jsxs)("form",{onSubmit:e=>h(e),className:"w-full h-full flex flex-col gap-3",children:[(0,t.jsx)("p",{children:"Subject"}),(0,t.jsx)("input",{type:"text",name:"sujet",placeholder:"Sujet",className:"p-2 border-2 rounded-lg"}),(0,t.jsx)("p",{children:"Destinataires"}),(0,t.jsx)("div",{className:"flex w-full max-h-[320px] no-scrollbar overflow-y-scroll",children:(0,t.jsx)("ul",{className:"w-full",children:e?.map(e=>t.jsxs("li",{className:`cursor-pointer flex gap-2 items-end my-2 border-2 rounded-lg p-2 ${r.includes(e.id)?"border-light-yellow":"border-inherit"}`,onClick:()=>g(e.id),children:[e.image?t.jsx(d.UserAvatar,{src:e.image}):t.jsx(c,{className:"size-12 opacity-40"}),t.jsx("span",{children:e.email})]},e.id))})}),(0,t.jsx)(n.A,{width:"100%",type:"submit",children:"Create"})]})]})})}},20124:(e,r,s)=>{"use strict";s.d(r,{default:()=>o});var t=s(45512);function o({children:e}){return(0,t.jsx)("div",{className:"no-scrollbar pt-[100px] fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center overflow-y-scroll",children:e})}s(58009)},24109:(e,r,s)=>{"use strict";s.d(r,{A:()=>o});var t=s(45512);function o({onClick:e,width:r,children:s,type:o}){return(0,t.jsx)("button",{type:o||"button",style:{width:r||"fit-content"},onClick:e,className:"inline-flex items-center justify-center px-4 py-1 border-2 text-lg rounded-lg bg-light-yellow text-dark-bg font-bold border-dark-bg hover:shadow-lg  transition-transform duration-300 ease-in-out ",children:s})}s(58009)},55852:(e,r,s)=>{"use strict";s.r(r),s.d(r,{UserAvatar:()=>a});var t=s(45512),o=s(45103);let a=({className:e,src:r,onClick:s})=>{let a=r&&r.trim()?r:"/images/DefaultUserAvatar1.png";return(0,t.jsx)("div",{className:`${e||"size-12"} ${s?"cursor-pointer":""} relative overflow-hidden rounded-full`,onClick:s,"aria-label":"User avatar",children:(0,t.jsx)(o.default,{width:350,height:350,src:a,className:"rounded-full border border-card object-cover overflow-hidden",alt:"user avatar"})})}},40770:(e,r,s)=>{"use strict";s.d(r,{c:()=>n});var t=s(21590);s(70376);var o=s(33582),a=s(26490),i=s(38803);async function n({sujet:e,participantsId:r,eventId:s}){let{user:t}=await (0,o.j2)()||{};if(!t)throw console.error("createConversation: no user found"),Error("No user found");try{let o=await (0,a.Rg)({title:e,eventId:s});if(await (0,i.cb)({userId:t.id,conversationId:o.id,role:"CREATOR"}),r&&r.length>0){let e=r.map(e=>({userId:e,conversationId:o.id}));await Promise.all(e.map(async e=>{await (0,i.cb)({userId:e.userId,conversationId:o.id,role:"GUEST"})}))}return{ok:!0,message:"Conversation cr\xe9\xe9e",newConversation:o}}catch(e){return console.error("Error creating new conversation:",e),{ok:!1,message:"Une erreur est survenue"}}}(0,s(99344).D)([n]),(0,t.A)(n,"40a45ea36b9f590f5279bf88e972aa253d9f1e05a7",null)},45025:(e,r,s)=>{"use strict";s.d(r,{NewMessagePage:()=>t});let t=(0,s(46760).registerClientReference)(function(){throw Error("Attempted to call NewMessagePage() from the server but NewMessagePage is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\messages\\new\\NewMessagePage.tsx","NewMessagePage")},40534:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>n});var t=s(62740),o=s(11587),a=s(45025),i=s(39290);async function n(){let e=await (0,i.j2)(),r=await o.A.user.findMany({where:{id:{not:e?.user?.id}},select:{id:!0,email:!0,name:!0,username:!0,image:!0}});return(0,t.jsx)(a.NewMessagePage,{users:r})}},33582:(e,r,s)=>{"use strict";s.d(r,{j2:()=>p,Jv:()=>v,CI:()=>x});var t=s(37067),o=s(96330),a=s(27261),i=s(73993),n=s(61088),l=s(7956),c=s(30342);let d=new o.PrismaClient,{handlers:u,auth:p,signIn:v,signOut:x}=(0,a.Ay)({trustHost:!0,adapter:(0,t.y)(d),secret:process.env.AUTH_SECRET,session:{strategy:"jwt",maxAge:604800,updateAge:604800},pages:{signIn:"/login",error:"/login/error"},callbacks:{jwt:async({token:e,trigger:r,session:s,user:t})=>(t&&(e.id=t.id,e.role=t.role,e.hasPassword=t.hasPassword),"update"===r&&s?.hasPassword!==void 0&&(e.hasPassword=s.hasPassword),e),session:async({session:e,token:r})=>({...e,user:{id:r.id,role:r.role,email:r.email,hasPassword:r.hasPassword}})},providers:[(0,n.A)({clientId:process.env.AUTH_GOOGLE_ID,clientSecret:process.env.AUTH_GOOGLE_SECRET,allowDangerousEmailAccountLinking:!0,authorization:{params:{prompt:"consent",access_type:"offline",response_type:"code"}}}),(0,l.A)({server:{host:process.env.EMAIL_SERVER_HOST,port:parseInt(process.env.EMAIL_SERVER_PORT,10),auth:{user:process.env.EMAIL_SERVER_USER,pass:process.env.EMAIL_SERVER_PASSWORD}},from:process.env.EMAIL_FROM,sendVerificationRequest:async e=>{let{identifier:r,url:s,provider:t}=e,o=(0,c.oO)(t.server),a=await o.sendMail({to:r,from:t.from,subject:"Bienvenue sur EventHub !",text:function({url:e}){return`Bienvenue sur EventHub !
Nous sommes ravis de vous accueillir. Pour continuer, cliquez sur le lien suivant pour vous connecter:
${e}

Si vous n'avez pas demand\xe9 cette connexion, vous pouvez ignorer cet email.
`}({url:s}),html:function(e){let{url:r}=e,s="#444";return`
<body style="background: #f9f9f9;">
  <table width="100%" border="0" cellspacing="20" cellpadding="0"
    style="background: #fff; max-width: 600px; margin: auto; border-radius: 10px;">
    <tr>
      <td align="center"
        style="padding: 10px 0px; font-size: 22px; font-family: Helvetica, Arial, sans-serif; color: ${s};">
        Bienvenue sur <strong>EventHub</strong> !
      </td>
    </tr>
    <tr>
      <td align="center"
        style="padding: 5px 0px 20px 0px; font-size: 16px; font-family: Helvetica, Arial, sans-serif; color: ${s};">
        Nous sommes ravis de vous accueillir. Pour continuer, cliquez sur le bouton ci-dessous pour commencer \xe0 utiliser votre compte !.
      </td>
    </tr>
    <tr>
      <td align="center" style="padding: 20px 0;">
        <table border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td align="center" style="border-radius: 5px;" bgcolor="#F3D250">
              <a href="${r}" target="_blank"
                style="font-size: 18px; font-family: Helvetica, Arial, sans-serif; color: black; text-decoration: none; border-radius: 5px; padding: 10px 20px; border: 1px solid black; display: inline-block; font-weight: bold;">
                Se connecter
              </a>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td align="center"
        style="padding: 0px 0px 10px 0px; font-size: 16px; line-height: 22px; font-family: Helvetica, Arial, sans-serif; color: ${s};">
        Si vous n'avez pas demand\xe9 cette connexion, vous pouvez ignorer cet email.
      </td>
    </tr>
  </table>
</body>
`}({url:s})}),i=a.rejected.concat(a.pending).filter(Boolean);if(i.length)throw Error(`Email(s) (${i.join(", ")}) could not be sent`)}}),(0,i.A)({name:"Credentials",authorize:async e=>e?{id:e.id,role:e.role,hasPassword:"true"===e.hasPassword,email:e.email}:null})]})},40492:(e,r,s)=>{"use strict";s.d(r,{A:()=>o});var t=s(96330);let o=globalThis.prismaGlobal??new t.PrismaClient},11587:(e,r,s)=>{"use strict";s.d(r,{A:()=>o});var t=s(96330);let o=globalThis.prismaGlobal??new t.PrismaClient},26490:(e,r,s)=>{"use strict";s.d(r,{Rg:()=>o,_g:()=>a});var t=s(40492);let o=async({title:e,eventId:r})=>{try{let s={title:e};return r&&(s.eventId=r),await t.A.conversation.create({data:s})}catch(e){throw console.error("createConversationService: error",e),Error("Service error: createConversationService")}},a=async e=>{try{let r=(await t.A.message.findMany({where:{conversationId:e},select:{id:!0}})).map(e=>e.id);await t.A.$transaction([t.A.messageStatus.deleteMany({where:{messageId:{in:r}}}),t.A.message.deleteMany({where:{conversationId:e}}),t.A.userConversation.deleteMany({where:{conversationId:e}}),t.A.conversation.delete({where:{id:e}})])}catch(e){throw console.error("deleteConversationService: error",e),Error("Service error: deleteConversationService")}}},38803:(e,r,s)=>{"use strict";s.d(r,{X1:()=>a,cb:()=>o,hw:()=>i,r1:()=>n});var t=s(40492);let o=async({userId:e,conversationId:r,role:s})=>{try{return await t.A.userConversation.create({data:{userId:e,conversationId:r,role:s}})}catch(e){throw console.error("createUserConversationService: error",e),Error("Service error: createUserConversationService")}},a=async({userId:e,conversationId:r})=>{try{return await t.A.userConversation.delete({where:{userId_conversationId:{userId:e,conversationId:r}}}),!0}catch(e){throw console.error("deleteUserConversationService: error",e),Error("Service error: deleteUserConversationService")}},i=async e=>{try{return await t.A.userConversation.findMany({where:{conversationId:e},select:{userId:!0}})}catch(e){throw console.error("getConversationService: error",e),Error("Service error: getConversationService")}},n=async({conversationId:e,userId:r})=>{try{return await t.A.userConversation.findUnique({where:{userId_conversationId:{userId:r,conversationId:e}}})}catch(e){throw console.error("selectConversationService: error",e),Error("Service error: selectConversationService")}}}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[87,895,671,103,899],()=>s(84144));module.exports=t})();