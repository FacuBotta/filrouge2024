(()=>{var e={};e.id=515,e.ids=[515],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79646:e=>{"use strict";e.exports=require("child_process")},55511:e=>{"use strict";e.exports=require("crypto")},14985:e=>{"use strict";e.exports=require("dns")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},79748:e=>{"use strict";e.exports=require("fs/promises")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},91645:e=>{"use strict";e.exports=require("net")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},27910:e=>{"use strict";e.exports=require("stream")},34631:e=>{"use strict";e.exports=require("tls")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},4573:e=>{"use strict";e.exports=require("node:buffer")},77598:e=>{"use strict";e.exports=require("node:crypto")},57975:e=>{"use strict";e.exports=require("node:util")},10312:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c});var s=r(70260),a=r(28203),n=r(25155),i=r.n(n),l=r(67292),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c=["",{children:["events",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,53663)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\events\\new\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,39381)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\events\\layout.tsx"]}],auth:["__DEFAULT__",{},{defaultPage:[()=>Promise.resolve().then(r.bind(r,91985)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\@auth\\default.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,1033)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,89977)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"]}],d=["C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\events\\new\\page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/events/new/page",pathname:"/events/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},78434:(e,t,r)=>{"use strict";r.r(t),r.d(t,{"7f5374c2b59c0ce6d5223a1edc8cea6edc1eb9550f":()=>a.J,"7fe13f6264349238c6e48141c1e4a57ee047053936":()=>s.Y});var s=r(53337),a=r(35443)},16508:(e,t,r)=>{"use strict";r.r(t),r.d(t,{"7f238c1258a29ee39d5f388db219007640a62450c7":()=>m});var s=r(21590);r(70376);var a=r(33582),n=r(45795),i=r(97585),l=r(59127),o=r(75328),c=r(40770),d=r(9890),u=r(99344);let m=async e=>{let t=await (0,a.j2)();if(!t||!t.user?.id)throw Error("Vous devez \xeatre connect\xe9 pour cr\xe9er un \xe9v\xe9nement");try{n.Wo.parse(e);let r=e.image;if(!r)throw Error("Aucun fichier d'image n'a \xe9t\xe9 s\xe9lectionn\xe9");let{imagePath:s}=await (0,d.V)(r,e.title);if(!s)throw Error("Erreur lors du t\xe9l\xe9chargement de l'image");let a={userId:t.user.id,categoryId:e.categoryId,title:e.title,description:e.description,eventStart:e.eventStart,eventEnd:e.eventEnd,isPublic:e.isPublic,image:s,locationUrl:e.address?.url,lat:e.address?.lat,lng:e.address?.lng,vicinity:e.address?.vicinity,formattedAddress:e.address?.formattedAddress},u=await (0,i.WL)(a),{newConversation:m}=await (0,c.c)({sujet:e.title,eventId:u.id,participantsId:e.participants?e.participants:null});if(!e.participants)return{ok:!0,message:"\xc9v\xe9nement cr\xe9\xe9 avec succ\xe8s"};if(m){let r=await Promise.all(e.participants.map(async e=>(0,o.o)({creatorId:t.user?.id,participantId:e,eventId:u.id,status:"WAITING_PARTICIPANT_RESPONSE",conversationId:m.id})));await Promise.all(r.map(r=>(0,l.N)({content:`Bonjour, je vous invite \xe0 mon nouvel \xe9v\xe9nement ${e.title} !`,conversationId:m.id,invitationId:r.id,senderId:t.user?.id})))}return{ok:!0,message:"\xc9v\xe9nement cr\xe9\xe9 avec succ\xe8s"}}catch(e){return console.error("createEvent: Error creating event",e),{ok:!1,message:"Erreur lors de la cr\xe9ation de l'\xe9v\xe9nement"}}};(0,u.D)([m]),(0,s.A)(m,"7f238c1258a29ee39d5f388db219007640a62450c7",null)},40579:(e,t,r)=>{Promise.resolve().then(r.bind(r,51361))},6235:(e,t,r)=>{Promise.resolve().then(r.bind(r,4336))},4336:(e,t,r)=>{"use strict";r.d(t,{NewEventPage:()=>g});var s=r(45512),a=r(26248);let n=(0,a.createServerReference)("7f238c1258a29ee39d5f388db219007640a62450c7",a.callServer,void 0,a.findSourceMapURL,"createEvent");var i=r(699),l=r(63917),o=r(74490),c=r(35748),d=r(79334),u=r(58009),m=r(91542),p=r(16131);let g=({availableCategories:e,contacts:t})=>{let[r,a]=(0,u.useState)({title:{message:"",value:!1},category:{message:"",value:!1},eventStart:{message:"",value:!1},eventEnd:{message:"",value:!1},description:{message:"",value:!1},address:{message:"",value:!1},image:{message:"",value:!1}}),g=(0,d.useRouter)(),x=(0,u.useRef)(null),[v,f]=(0,u.useState)(null),[h,b]=(0,u.useState)(null),[w,y]=(0,u.useState)(!1),[j,E]=(0,u.useState)([]),N=()=>{if(a({...r,image:{message:"",value:!1}}),b(""),x.current){let e=x.current.files?.[0];if(e){if(e.size>2e6){a({...r,image:{message:"La taille du fichier d\xe9passe 2Mo !",value:!0}}),x.current.value="";return}if(e){let t=new FileReader;t.onload=e=>{b(e.target?.result)},t.readAsDataURL(e)}}}},z=async e=>{if(e.preventDefault(),a({title:{message:"",value:!1},category:{message:"",value:!1},eventStart:{message:"",value:!1},eventEnd:{message:"",value:!1},description:{message:"",value:!1},address:{message:"",value:!1},image:{message:"",value:!1}}),!v){a({...r,address:{message:"Ubication obligatoire",value:!0}});return}let t=new FormData(e.currentTarget),s="on"===t.get("endSameDay");if(!s&&""===t.get("eventEnd")){a({...r,eventEnd:{message:"La date de fin est obligatoire",value:!0}});return}if(console.log(t.get("category")),"Cat\xe9gorie"===t.get("category")){a({...r,category:{message:"La cat\xe9gorie est obligatoire",value:!0}});return}let i={title:t.get("title"),categoryId:t.get("category"),isPublic:"on"===t.get("isPublic"),image:t.get("image"),eventStart:new Date(t.get("eventStart")),eventEnd:s?null:new Date(t.get("eventEnd")),description:t.get("description"),participants:j,address:{url:v.url,lat:v.lat,lng:v.lng,formattedAddress:v.formattedAddress,vicinity:v.vicinity}};try{o.Wo.parse(i);let e=await n(i);e?.ok&&(m.o.success(e.message),g.push("/events"))}catch(e){console.log(e),e instanceof p.z.ZodError?e.errors.forEach(e=>{let t=e.path[0];a(r=>({...r,[t]:{message:e.message,value:!0}}))}):e instanceof Error&&(m.o.error(e.message),console.log(e)),m.o.error("Une erreur est survenue \uD83D\uDE11")}};return(0,s.jsxs)("div",{className:"w-full max-w-[900px] mx-auto",children:[(0,s.jsxs)("header",{className:"relative w-full mb-5",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold",children:"Cr\xe9er un \xe9ventement \uD83D\uDE80"}),(0,s.jsx)("button",{onClick:()=>g.back(),children:(0,s.jsx)(c.In,{type:"goBack",strokeWidth:2,className:"size-10 absolute right-[10px] top-[10px]"})})]}),(0,s.jsxs)("main",{className:"flex flex-col items-center justify-center mb-5 w-full relative rounded-xl border-2 border-light-borderCards bg-light-cards dark:border-dark-borderCards dark:bg-dark-cards",children:[(0,s.jsxs)("form",{className:"flex flex-col w-full gap-5 ",onSubmit:z,children:[(0,s.jsxs)("header",{className:"h-[300px] w-full border-b-2 rounded-tl-lg rounded-tr-lg border-black dark:border-dark-borderCards relative hover:bg-light-grey/10 bg-cover bg-center",style:{backgroundImage:`url(${h})`},children:[(0,s.jsx)("input",{ref:x,onChange:()=>N(),onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},type:"file",accept:"image/*",name:"image",required:!0,className:"relative h-full w-full opacity-0 cursor-pointer"}),(0,s.jsx)("span",{className:`absolute left-[50%] top-[50%] translate-x-[-50%] translate-y-[-50%] text-2xl dark:text-light-grey/50 cursor-pointer ${r.image.value?"text-red-500":""}`,children:r.image.value?r.image.message:"S\xe9lectionner une image"})]}),(0,s.jsxs)("section",{className:"flex w-full gap-5 mt-2 justify-between  flex-wrap px-5",children:[(0,s.jsxs)("fieldset",{className:"flex flex-col sm:w-[50%] ",children:[(0,s.jsxs)("div",{className:"flex w-full gap-2 flex-col",children:[(0,s.jsx)("input",{className:"newEventInput sm:!w-[500px] ",type:"text",name:"title",placeholder:"Titre du \xe9v\xe9nement (max 100 caract\xe8res)",required:!0}),r.title?.value&&(0,s.jsx)("span",{className:"text-red-500 text-[1.2rem] mx-auto",children:r.title?.message}),(0,s.jsxs)("select",{className:"newEventInput",name:"category",children:[(0,s.jsx)("option",{children:"Cat\xe9gorie"}),e.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title},e.id))]}),r.category?.value&&(0,s.jsx)("span",{className:"text-red-500 text-[1.2rem]",children:r.category?.message})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 mt-5",children:[(0,s.jsx)("button",{type:"button",className:"primary-btn h-10",onClick:()=>y(!0),children:"Inviter des participants"}),(0,s.jsxs)("label",{htmlFor:"isPublic",className:"text-xl flex gap-2 select-none ml-2",children:[(0,s.jsx)("input",{type:"checkbox",name:"isPublic",id:"isPublic",className:"w-4"}),"\xc9v\xe9nement publique"]})]})]}),(0,s.jsxs)("fieldset",{className:"flex flex-col gap-2",children:[(0,s.jsxs)("label",{htmlFor:"eventStart",className:"text-2xl flex flex-col gap-2",children:["Commence le:",(0,s.jsx)("input",{className:"newEventInput !w-[250px] sm:w-[320px] sm:ml-3",type:"datetime-local",name:"eventStart",placeholder:"Date de d\xe9but"})]}),r.eventStart?.value&&(0,s.jsx)("span",{className:"text-red-500 text-[1.2rem] mx-auto",children:r.eventStart?.message}),(0,s.jsxs)("label",{htmlFor:"eventEnd",className:"text-2xl flex flex-col gap-2",children:["Se termine le:",(0,s.jsx)("input",{className:"newEventInput !w-[250px] sm:w-[320px] sm:ml-3",type:"datetime-local",name:"eventEnd",placeholder:"Date de fin"})]}),(0,s.jsxs)("label",{htmlFor:"endSameDay",className:"text-xl flex gap-2 select-none ml-3",children:[(0,s.jsx)("input",{type:"checkbox",name:"endSameDay",id:"endSameDay",className:"w-4"}),"Se termine la m\xeame journ\xe9e"]}),r.eventEnd?.value&&(0,s.jsx)("span",{className:"text-red-500 text-[1.2rem]",children:r.eventEnd?.message})]})]}),(0,s.jsxs)("section",{className:"flex gap-5 w-full justify-between items-start mt-2 flex-wrap px-5 ",children:[(0,s.jsx)("textarea",{className:"p-4 mt-10 border-2 border-black dark:border-dark-grey/50 rounded-lg dark:bg-transparent dark:placeholder:text-dark-greenLight/50 w-full",rows:10,name:"description",placeholder:"Description du \xe9v\xe9nement (entre 30 et 1000 caract\xe8res \uD83D\uDE09)"}),r.description?.value&&(0,s.jsx)("span",{className:"text-blue-500 text-[1.2rem] mx-auto",children:r.description?.message})]}),(0,s.jsxs)("section",{className:"w-full px-5",children:[(0,s.jsx)("h3",{className:"text-2xl",children:"Ubication :"}),(0,s.jsx)("span",{className:"text-red-500",children:r.address?.message?r.address?.message:""}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)(l.A,{onAddressChange:f})})]}),(0,s.jsx)("div",{className:"w-full p-5",children:(0,s.jsx)("button",{className:"primary-btn w-full",type:"submit",children:"Cr\xe9er l'\xe9v\xe9nement"})})]}),w&&(0,s.jsx)("div",{className:"fixed top-0 left-0 w-full h-full bg-black/80 flex justify-center items-center sm:pt-20",children:(0,s.jsx)(i.A,{users:t,takeUsers:e=>{E(e),y(!1)},closeModal:()=>{E([]),y(!w)}})})]})]})}},40770:(e,t,r)=>{"use strict";r.d(t,{c:()=>l});var s=r(21590);r(70376);var a=r(33582),n=r(26490),i=r(38803);async function l({sujet:e,participantsId:t,eventId:r}){let{user:s}=await (0,a.j2)()||{};if(!s)throw console.error("createConversation: no user found"),Error("No user found");try{let a=await (0,n.Rg)({title:e,eventId:r});if(await (0,i.cb)({userId:s.id,conversationId:a.id,role:"CREATOR"}),t&&t.length>0){let e=t.map(e=>({userId:e,conversationId:a.id}));await Promise.all(e.map(async e=>{await (0,i.cb)({userId:e.userId,conversationId:a.id,role:"GUEST"})}))}return{ok:!0,message:"Conversation cr\xe9\xe9e",newConversation:a}}catch(e){return console.error("Error creating new conversation:",e),{ok:!1,message:"Une erreur est survenue"}}}(0,r(99344).D)([l]),(0,s.A)(l,"40a45ea36b9f590f5279bf88e972aa253d9f1e05a7",null)},51361:(e,t,r)=>{"use strict";r.d(t,{NewEventPage:()=>s});let s=(0,r(46760).registerClientReference)(function(){throw Error("Attempted to call NewEventPage() from the server but NewEventPage is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\events\\new\\newEventPage.tsx","NewEventPage")},53663:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var s=r(62740),a=r(35443),n=r(4858),i=r(51361);async function l(){let e=await (0,a.J)(),t=await (0,n.K)();return(0,s.jsx)(i.NewEventPage,{availableCategories:e,contacts:t})}},45795:(e,t,r)=>{"use strict";r.d(t,{$w:()=>n,Wo:()=>l,q8:()=>o,y4:()=>a});var s=r(16500);let a=s.z.object({email:s.z.string().email({message:"Veuillez utiliser une adresse e-mail valide"})}),n=s.z.object({password:s.z.string().min(8,{message:"Le mot de passe doit \xeatre de 8 caract\xe8res minimum"}).max(30,{message:"Le mot de passe doit \xeatre de 30 caract\xe8res maximum"}).regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[#@$!%*?&])[A-Za-z\d#@$!%*?&]{8,30}$/,{message:"8 caract\xe8res, une majuscule, une minuscule, un chiffre et un caract\xe8re sp\xe9cial, ' \" _ - ne sont pas autoris\xe9s"})});s.z.object({email:s.z.string().email({message:"Veuillez utiliser une adresse e-mail valide"})});let i=s.z.object({url:s.z.string().url(),lat:s.z.number(),lng:s.z.number(),formattedAddress:s.z.string(),vicinity:s.z.string()}),l=s.z.object({categoryId:s.z.string(),title:s.z.string().max(100,{message:"Le titre doit \xeatre de 100 caract\xe8res maximum"}),description:s.z.string().min(30,{message:"Il faut un peu de l'inspiration pour cette description!"}).max(1e3,{message:"La description doit \xeatre de 1000 caract\xe8res maximum"}),eventStart:s.z.date().refine(e=>{let t=new Date;return!isNaN(e.getTime())&&e>=t},{message:"La date doit \xeatre valide et ne peut pas \xeatre dans le pass\xe9"}),eventEnd:s.z.date().nullable().refine(e=>{if(!e)return!0;let t=new Date;return!isNaN(e.getTime())&&e>=t},{message:"La date doit \xeatre valide et ne peut pas \xeatre dans le pass\xe9"}),isPublic:s.z.boolean(),participants:s.z.array(s.z.string()),address:i,image:s.z.instanceof(File)});s.z.string().regex(RegExp("^(sport|education|language|city tours|air libre|autres)$"),{message:"Titre invalide"});let o=s.z.object({username:s.z.string().max(30,"Le nom d'utilisateur doit comporter 30 caract\xe8res ou moins").optional(),image:s.z.union([s.z.instanceof(File).refine(e=>e.size<=2097152,{message:"La taille de l'image doit \xeatre de 2 Mo ou moins"}),s.z.null(),s.z.undefined()]).optional(),description:s.z.string().max(1e3,"La description doit comporter 1000 caract\xe8res ou moins").optional(),oldImage:s.z.string().optional()}),c=s.z.object({id:s.z.string(),email:s.z.string().email().nullable(),username:s.z.string().nullable(),image:s.z.string().nullable(),description:s.z.string().nullable(),_count:s.z.object({Ratings:s.z.number(),EventsCreated:s.z.number()})});s.z.array(c)},26490:(e,t,r)=>{"use strict";r.d(t,{Rg:()=>a,_g:()=>n});var s=r(40492);let a=async({title:e,eventId:t})=>{try{let r={title:e};return t&&(r.eventId=t),await s.A.conversation.create({data:r})}catch(e){throw console.error("createConversationService: error",e),Error("Service error: createConversationService")}},n=async e=>{try{let t=(await s.A.message.findMany({where:{conversationId:e},select:{id:!0}})).map(e=>e.id);await s.A.$transaction([s.A.messageStatus.deleteMany({where:{messageId:{in:t}}}),s.A.message.deleteMany({where:{conversationId:e}}),s.A.userConversation.deleteMany({where:{conversationId:e}}),s.A.conversation.delete({where:{id:e}})])}catch(e){throw console.error("deleteConversationService: error",e),Error("Service error: deleteConversationService")}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[87,895,671,103,512,500,429,899,683,766],()=>r(10312));module.exports=s})();