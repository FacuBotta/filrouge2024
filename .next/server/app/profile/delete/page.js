(()=>{var e={};e.id=526,e.ids=[526],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},5486:e=>{"use strict";e.exports=require("bcrypt")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79646:e=>{"use strict";e.exports=require("child_process")},55511:e=>{"use strict";e.exports=require("crypto")},14985:e=>{"use strict";e.exports=require("dns")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},79748:e=>{"use strict";e.exports=require("fs/promises")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},91645:e=>{"use strict";e.exports=require("net")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},27910:e=>{"use strict";e.exports=require("stream")},34631:e=>{"use strict";e.exports=require("tls")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},4573:e=>{"use strict";e.exports=require("node:buffer")},77598:e=>{"use strict";e.exports=require("node:crypto")},57975:e=>{"use strict";e.exports=require("node:util")},74260:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>o.a,__next_app__:()=>d,pages:()=>u,routeModule:()=>p,tree:()=>c});var s=t(70260),i=t(28203),a=t(25155),o=t.n(a),n=t(67292),l={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);t.d(r,l);let c=["",{children:["profile",{children:["delete",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,49278)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\profile\\delete\\page.tsx"]}]},{}]},{}],auth:["__DEFAULT__",{},{defaultPage:[()=>Promise.resolve().then(t.bind(t,91985)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\@auth\\default.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,1033)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,89977)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\not-found.tsx"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,41485,23)),"next/dist/client/components/unauthorized-error"]}],u=["C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\profile\\delete\\page.tsx"],d={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/profile/delete/page",pathname:"/profile/delete",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},14817:(e,r,t)=>{"use strict";t.r(r),t.d(r,{"7fe13f6264349238c6e48141c1e4a57ee047053936":()=>s.Y});var s=t(53337)},31633:(e,r,t)=>{"use strict";t.r(r),t.d(r,{"7f2e9f6fd93cfb8a764f96489758fd5c1918fd4816":()=>m});var s=t(21590);t(70376);var i=t(33582),a=t(45795),o=t(97585),n=t(17038),l=t(49755),c=t(16500),u=t(76752),d=t(43567),p=t(99344);let m=async e=>{let r=await (0,i.j2)(),t=(0,l.h)(e,"id"),s=(0,l.h)(e,"password");if(!r||!r.user?.id||!r.user.hasPassword||!r.user.email||"admin"!==r.user.role&&r.user.id!==t)return console.error("deleteProfile: no session found"),{ok:!1,message:"Aucun session trouv\xe9e"};try{if(a.$w.parse({password:s}),!await (0,d.O)({inputPassword:s,email:r.user.email}))return{ok:!1,message:"Mot de passe incorrect"};let e=await (0,n.Td)({id:t});if(!e||e.email!==r.user.email)throw Error("Erreur lors de la suppression du profil");let i=e.image,l=(await (0,o.z9)(t)).map(e=>e.image);return await Promise.all(l.map(async e=>{e&&await (0,u.v)(e)})),i&&await (0,u.v)(i),await (0,n.qM)({userId:r.user.id}),{ok:!0,message:"Compte supprim\xe9 avec succ\xe8s"}}catch(e){if(e instanceof c.G)return{ok:!1,message:"Mot de passe invalide"};return console.error("Erreur lors de la suppression du profil:",e),{ok:!1,message:"Erreur lors de la suppression du profil"}}};(0,p.D)([m]),(0,s.A)(m,"7f2e9f6fd93cfb8a764f96489758fd5c1918fd4816",null)},55880:(e,r,t)=>{Promise.resolve().then(t.bind(t,90038)),Promise.resolve().then(t.bind(t,23104)),Promise.resolve().then(t.bind(t,9797)),Promise.resolve().then(t.bind(t,86382))},42728:(e,r,t)=>{Promise.resolve().then(t.bind(t,16684)),Promise.resolve().then(t.bind(t,20124)),Promise.resolve().then(t.bind(t,8089)),Promise.resolve().then(t.bind(t,99318))},16684:(e,r,t)=>{"use strict";t.d(r,{default:()=>m});var s=t(45512),i=t(26248);let a=(0,i.createServerReference)("7f2e9f6fd93cfb8a764f96489758fd5c1918fd4816",i.callServer,void 0,i.findSourceMapURL,"deleteProfile");var o=t(74490),n=t(95226),l=t(35748),c=t(66712),u=t(58009),d=t(91542),p=t(16131);function m({id:e}){let[r,t]=(0,u.useState)({message:"",value:!1}),i=async e=>{e.preventDefault();let r=new FormData(e.currentTarget);try{let e=(0,n.h)(r,"password");e||t({message:"Mot de passe manquant",value:!0}),o.$w.parse({password:e});let s=await a(r);s?.ok?(d.o.success(s.message),(0,c.CI)({callbackUrl:"/"})):(d.o.error(s.message),t({message:s.message,value:!0}))}catch(e){if(e instanceof p.G){d.o.error("Mot de passe invalide"),t({message:"Mot de passe invalide",value:!0});return}d.o.error("Une erreur est survenue")}};return(0,s.jsxs)("form",{className:"flex flex-col items-center justify-center w-full gap-5",onSubmit:i,children:[(0,s.jsx)("input",{type:"text",className:"hidden",name:"id",defaultValue:e}),(0,s.jsx)(l.pd,{label:"Mot de passe",required:!0,type:"password",name:"password",placeholder:"Votre mot de passe",className:"primary-input",defaultValue:"",error:{message:r.message,value:r.value}}),(0,s.jsx)("button",{type:"submit",className:"secondary-btn w-full",children:"Supprimer mon compte"})]})}},76752:(e,r,t)=>{"use strict";t.d(r,{v:()=>o});var s=t(79748),i=t(33873),a=t.n(i);async function o(e){let r=a().join(process.cwd(),"public",e);try{await (0,s.unlink)(r)}catch(e){throw console.error("Error deleting the image:",e),Error("Erreur lors de la suppression de l'image")}}},43567:(e,r,t)=>{"use strict";t.d(r,{O:()=>c});var s=t(21590);t(70376);var i=t(45795),a=t(5486),o=t.n(a),n=t(67611),l=t(99344);let c=async({inputPassword:e,hashedPassword:r,email:t})=>{try{if(r)return await o().compare(e,r);if(!r&&t){i.y4.parse({email:t});let r=await (0,n.A)(t);if(!r?.password)return!1;let s=r.password;return await o().compare(e,s)}return!1}catch(e){return console.error("Error al verificar la contrase\xf1a:",e),!1}};(0,l.D)([c]),(0,s.A)(c,"7faaecf046cb5b8d941bfcfad4c2bd225f09d86dba",null)},67611:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});var s=t(21590);t(70376);var i=t(17038);async function a(e){try{return await (0,i.cT)({email:e})}catch(e){return console.log(e),null}}(0,t(99344).D)([a]),(0,s.A)(a,"40b80a991cc8f7c1cc7ee98d4d6ab0d55315e6e3e4",null)},49278:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var s=t(62740),i=t(53337),a=t(90038),o=t(23104),n=t(9797),l=t(86382),c=t(31831);let u=async()=>{let{user:e}=await (0,i.Y)();return e&&e.id||(0,c.redirect)("/login"),(0,s.jsx)(o.default,{children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-10 mt-[150px] sm:mt-[180px] mb-5 w-full max-w-[900px] mx-2 bg-light-ciel relative rounded-xl border-2 border-light-yellow dark:bg-dark-bg ",children:[(0,s.jsx)(l.Link,{href:"/profile",children:(0,s.jsx)(n.default,{type:"plus",strokeWidth:2,className:"transform rotate-45 absolute right-[10px] top-[10px]"})}),(0,s.jsx)("h1",{className:"text-3xl font-semibold",children:"Tu va nous manquer \uD83D\uDE22"}),(0,s.jsx)("div",{className:"items-center justify-center gap-5 min-h-[200px] w-full max-w-[500px] mx-auto mt-5",children:(0,s.jsx)(a.default,{id:e.id})})]})})}},90038:(e,r,t)=>{"use strict";t.d(r,{default:()=>s});let s=(0,t(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\User\\\\Documents\\\\Hi world\\\\ADRAR 2024\\\\Fil Rouge\\\\components\\\\forms\\\\DeleteProfileForm.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\components\\forms\\DeleteProfileForm.tsx","default")},97585:(e,r,t)=>{"use strict";t.d(r,{DN:()=>o,WL:()=>i,Yw:()=>n,xP:()=>a,z9:()=>l});var s=t(40492);let i=async e=>{try{return await s.A.events.create({data:e})}catch(e){throw console.error("createEventService: error",e),Error("Service error: createEventService")}},a=async(e,r)=>{try{return await s.A.events.update({where:{id:r},data:e})}catch(e){throw console.error("updateEventService: error",e),Error("Service error: updateEventService")}},o=async e=>{try{return await s.A.events.delete({where:{id:e}}),!0}catch(e){throw console.error("deleteEventService: error",e),Error("Service error: deleteEventService")}},n=async e=>{try{let r=await s.A.events.findFirst({select:{id:!0,title:!0,description:!0,eventStart:!0,eventEnd:!0,isPublic:!0,image:!0,locationUrl:!0,lat:!0,lng:!0,vicinity:!0,formattedAddress:!0,createdAt:!0,updatedAt:!0,conversation:{select:{id:!0}},participants:{select:{userId:!0}},UserInvitations:{select:{id:!0,participantId:!0,creatorId:!0,eventId:!0,conversationId:!0,createdAt:!0,status:!0}},category:{select:{id:!0,title:!0}},user:{select:{id:!0,email:!0,username:!0,image:!0,description:!0,_count:{select:{EventsCreated:!0,Ratings:!0}}}},_count:{select:{participants:!0}}},where:{id:e}});if(!r)return null;return r}catch(e){return console.error(e),null}},l=async e=>{try{return await s.A.events.findMany({where:{userId:e},select:{id:!0,title:!0,description:!0,eventStart:!0,eventEnd:!0,isPublic:!0,image:!0,locationUrl:!0,lat:!0,lng:!0,vicinity:!0,formattedAddress:!0,createdAt:!0,updatedAt:!0,Tasks:{select:{id:!0,userId:!0,eventId:!0,content:!0,completed:!0,createdAt:!0,order:!0}},conversation:{select:{id:!0}},participants:{select:{userId:!0}},UserInvitations:{select:{id:!0,participantId:!0,creatorId:!0,eventId:!0,conversationId:!0,createdAt:!0,status:!0}},category:{select:{id:!0,title:!0}},_count:{select:{participants:!0}}},orderBy:{eventStart:"asc"}})}catch(e){return console.error(e),[]}}},49755:(e,r,t)=>{"use strict";t.d(r,{S:()=>i,h:()=>s});let s=(e,r)=>{let t=e.get(r);return"string"==typeof t?t.trim():""},i=(e,r)=>{let t=e.get(r);return t instanceof File?t:null}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[87,895,671,512,500,899,321],()=>t(74260));module.exports=s})();