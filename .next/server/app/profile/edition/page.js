(()=>{var e={};e.id=793,e.ids=[793],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79646:e=>{"use strict";e.exports=require("child_process")},55511:e=>{"use strict";e.exports=require("crypto")},14985:e=>{"use strict";e.exports=require("dns")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},79748:e=>{"use strict";e.exports=require("fs/promises")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},91645:e=>{"use strict";e.exports=require("net")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},27910:e=>{"use strict";e.exports=require("stream")},34631:e=>{"use strict";e.exports=require("tls")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},4573:e=>{"use strict";e.exports=require("node:buffer")},77598:e=>{"use strict";e.exports=require("node:crypto")},57975:e=>{"use strict";e.exports=require("node:util")},39298:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>o.a,__next_app__:()=>c,pages:()=>u,routeModule:()=>m,tree:()=>d});var s=t(70260),i=t(28203),a=t(25155),o=t.n(a),n=t(67292),l={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);t.d(r,l);let d=["",{children:["profile",{children:["edition",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,24635)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\profile\\edition\\page.tsx"]}]},{}]},{}],auth:["__DEFAULT__",{},{defaultPage:[()=>Promise.resolve().then(t.bind(t,91985)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\@auth\\default.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,1033)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,89977)),"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\not-found.tsx"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,41485,23)),"next/dist/client/components/unauthorized-error"]}],u=["C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\app\\profile\\edition\\page.tsx"],c={require:t,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/profile/edition/page",pathname:"/profile/edition",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},98144:(e,r,t)=>{"use strict";t.r(r),t.d(r,{"40a6fab70b313fd13f9ac52c0a962d6328c849a0f5":()=>i.A,"7fe13f6264349238c6e48141c1e4a57ee047053936":()=>s.Y});var s=t(53337),i=t(44328)},7838:(e,r,t)=>{"use strict";t.r(r),t.d(r,{"7f31ddd0bc2d3ef96cfd216ce1f43d5de50d4fd86b":()=>m});var s=t(21590);t(70376);var i=t(33582),a=t(80956),o=t(45795),n=t(17038),l=t(49755),d=t(76752),u=t(9890),c=t(99344);let m=async e=>{let r=await (0,i.j2)();if(!r||!r.user?.id)throw console.error("updateUserProfile: no session found"),Error("No session found");try{let t=(0,l.h)(e,"description"),s=(0,l.h)(e,"username"),i=(0,l.S)(e,"new-image"),a=(0,l.h)(e,"old-image");o.q8.parse({username:s,image:i,description:t,oldImagePath:a});let c={username:s,description:t,image:a};if(i){let{imagePath:e}=await (0,u.V)(i,s);if(!e)throw Error("Erreur lors du t\xe9l\xe9chargement de l'image");c.image=e,a?.length>0&&await (0,d.v)(a)}return await (0,n.Aw)({id:r.user.id,data:c}),{ok:!0,message:"Profil mis \xe0 jour"}}catch(r){let e=(0,a.H)(r);return{ok:e.ok,message:e.message}}};(0,c.D)([m]),(0,s.A)(m,"7f31ddd0bc2d3ef96cfd216ce1f43d5de50d4fd86b",null)},55911:(e,r,t)=>{Promise.resolve().then(t.bind(t,12693)),Promise.resolve().then(t.bind(t,23104)),Promise.resolve().then(t.bind(t,9797)),Promise.resolve().then(t.bind(t,86382))},86175:(e,r,t)=>{Promise.resolve().then(t.bind(t,49672)),Promise.resolve().then(t.bind(t,20124)),Promise.resolve().then(t.bind(t,8089)),Promise.resolve().then(t.bind(t,99318))},49672:(e,r,t)=>{"use strict";t.d(r,{EditProfileForm:()=>p});var s=t(45512),i=t(26248);let a=(0,i.createServerReference)("7f31ddd0bc2d3ef96cfd216ce1f43d5de50d4fd86b",i.callServer,void 0,i.findSourceMapURL,"updateUserProfile");var o=t(74490),n=t(55852),l=t(95226),d=t(79334),u=t(58009),c=t(91542),m=t(16131);let p=({username:e,image:r,description:t})=>{let i=(0,d.useRouter)(),[p,f]=(0,u.useState)(r);console.log("form form",r);let g=async e=>{e.preventDefault();let t=new FormData(e.currentTarget);try{let e=(0,l.h)(t,"username"),s=(0,l.h)(t,"description"),n=(0,l.S)(t,"new-image");o.q8.parse({username:e,image:n,description:s}),r===p&&t.delete("new-image"),r&&t.append("old-image",r);let d=await a(t);d.ok?(c.o.success(d.message),i.push("/profile")):c.o.error(d.message)}catch(e){if(e instanceof m.G){let r=e.errors.map(e=>e.message).join(", ");c.o.error(`Erreur de validation : ${r}`)}else console.error("Une erreur est survenue :",e),c.o.error("Une erreur inattendue est survenue. Veuillez r\xe9essayer.")}};return(0,s.jsx)("div",{className:"flex flex-col items-center justify-center w-full",children:(0,s.jsxs)("form",{className:"flex flex-col gap-5 mt-2 w-full",onSubmit:e=>g(e),children:[(0,s.jsxs)("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[(0,s.jsx)(n.UserAvatar,{src:p,className:"size-32 my-5 mx-auto"}),(0,s.jsx)("input",{id:"image-upload",type:"file",name:"new-image",accept:"image/*",onChange:e=>{let r=e.target.files?.[0];if(r){let e=new FileReader;e.onloadend=()=>{f(e.result)},e.readAsDataURL(r)}},className:"hidden"})]}),(0,s.jsx)("input",{className:"p-2 border-2 rounded-lg border-dark-bg dark:border-white",type:"text",name:"username",defaultValue:e||"",placeholder:"Username"}),(0,s.jsx)("textarea",{className:"p-2 border-2 rounded-lg border-dark-bg dark:border-white",name:"description",rows:6,maxLength:300,defaultValue:t||"",placeholder:"Donne une petite description de toi pour partager avec le reste de la communaut\xe9! (max 300 caract\xe8res)"}),(0,s.jsx)("button",{type:"submit",className:"primary-btn !w-full",children:"Sauvegarder"})]})})}},55852:(e,r,t)=>{"use strict";t.r(r),t.d(r,{UserAvatar:()=>a});var s=t(45512),i=t(45103);let a=({className:e,src:r,onClick:t})=>{let a=r&&r.trim()?r:"/images/DefaultUserAvatar1.png";return(0,s.jsx)("div",{className:`${e||"size-12"} ${t?"cursor-pointer":""} relative overflow-hidden rounded-full`,onClick:t,"aria-label":"User avatar",children:(0,s.jsx)(i.default,{width:350,height:350,src:a,className:"rounded-full border border-card object-cover overflow-hidden",alt:"user avatar"})})}},76752:(e,r,t)=>{"use strict";t.d(r,{v:()=>o});var s=t(79748),i=t(33873),a=t.n(i);async function o(e){let r=a().join(process.cwd(),"public",e);try{await (0,s.unlink)(r)}catch(e){throw console.error("Error deleting the image:",e),Error("Erreur lors de la suppression de l'image")}}},9890:(e,r,t)=>{"use strict";t.d(r,{V:()=>o});var s=t(79748),i=t(33873),a=t.n(i);async function o(e,r){if(!e)throw Error("No file provided");let t=r.replace(/[^a-zA-Z0-9-_]/g,"_"),i=`${t}_${Date.now()}.jpg`,o=`/uploads/${i}`,n=await e.arrayBuffer(),l=a().join(process.cwd(),"public","uploads",i);try{return await (0,s.writeFile)(l,Buffer.from(n)),{imagePath:o}}catch(e){return console.error("Error saving the image:",e),{imagePath:null}}}},44328:(e,r,t)=>{"use strict";t.d(r,{A:()=>o});var s=t(88977);t(98063);var i=t(2121),a=t(11527);async function o(e){try{let r=await (0,i.Vg)({id:e});if(!r)return null;return(0,a.M)(r)}catch(e){return console.error(e),null}}(0,t(56215).D)([o]),(0,s.A)(o,"40a6fab70b313fd13f9ac52c0a962d6328c849a0f5",null)},24635:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c});var s=t(62740),i=t(53337),a=t(44328),o=t(12693),n=t(23104),l=t(9797),d=t(86382),u=t(31831);let c=async()=>{let{user:e}=await (0,i.Y)(),r=await (0,a.A)(e?.id);r||(0,u.redirect)("/login");let{description:t,username:c,image:m}=r;return(0,s.jsx)(n.default,{children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-10 mt-[150px] sm:mt-[180px] mb-5 w-full max-w-[900px] mx-2 bg-light-ciel relative rounded-xl border-2 border-light-yellow dark:bg-dark-bg ",children:[(0,s.jsx)(d.Link,{href:"/profile",children:(0,s.jsx)(l.default,{type:"plus",strokeWidth:2,className:"transform rotate-45 absolute right-[10px] top-[10px]"})}),(0,s.jsx)("h1",{className:"text-3xl font-semibold",children:"Edition de mon profil"}),(0,s.jsxs)("div",{className:"items-center justify-center gap-5 w-full max-w-[500px] mx-auto",children:[(0,s.jsx)(o.EditProfileForm,{username:c,image:m,description:t}),(0,s.jsx)(d.Link,{className:"w-full flex justify-center mt-5",href:"/set-password",children:"Modifier mon mot de passe"}),(0,s.jsx)(d.Link,{className:"w-full flex justify-center text-red-600",href:"/profile/delete",children:"Supprimer mon compte"})]})]})})}},12693:(e,r,t)=>{"use strict";t.d(r,{EditProfileForm:()=>s});let s=(0,t(46760).registerClientReference)(function(){throw Error("Attempted to call EditProfileForm() from the server but EditProfileForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\User\\Documents\\Hi world\\ADRAR 2024\\Fil Rouge\\components\\forms\\EditProfileForm.tsx","EditProfileForm")},11587:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var s=t(96330);let i=globalThis.prismaGlobal??new s.PrismaClient},80956:(e,r,t)=>{"use strict";t.d(r,{H:()=>a});class s extends Error{constructor(e,r){super(e),this.name=this.constructor.name,this.ok=!1,this.message=e,this.errors=r}}var i=t(16500);function a(e){if(e instanceof i.G){let r=e.errors.map(({message:e,path:r})=>({message:e,path:r}));return new s(r.map(e=>e.message).join(", "),r)}return new s("Une erreur est survenue")}},2121:(e,r,t)=>{"use strict";t.d(r,{Vg:()=>a,ZR:()=>i});var s=t(11587);let i=async()=>{try{return await s.A.user.findMany({select:{id:!0,email:!0,username:!0,image:!0,description:!0,_count:{select:{Ratings:!0,EventsCreated:!0}}}})}catch(e){return console.error("selectAllUsersService",e),null}},a=async({id:e})=>{if(!e||"string"!=typeof e)return null;try{let r=await s.A.user.findUnique({where:{id:e},select:{id:!0,email:!0,username:!0,image:!0,description:!0,EventsCreated:{select:{id:!0,title:!0,description:!0,eventStart:!0,eventEnd:!0,isPublic:!0,image:!0,createdAt:!0,updatedAt:!0,formattedAddress:!0,conversation:{select:{id:!0}},participants:{select:{userId:!0}},category:{select:{id:!0,title:!0}},UserInvitations:!0,Tasks:!0},orderBy:{eventStart:"asc"}},EventsJoined:{select:{event:{select:{id:!0,title:!0,description:!0,user:{select:{id:!0,username:!0,image:!0}},eventStart:!0,eventEnd:!0,isPublic:!0,image:!0,createdAt:!0,updatedAt:!0,formattedAddress:!0,conversation:{select:{id:!0}},category:{select:{id:!0,title:!0}},_count:{select:{participants:!0}}}}}},Tasks:!0,CommentsReceived:{select:{id:!0,createdAt:!0,updatedAt:!0,content:!0,recipientId:!0,author:{select:{id:!0,username:!0,image:!0}},rating:{select:{score:!0}}}}}});if(!r)return null;return r}catch(e){return console.error("selectUserDataService",e),null}}},11527:(e,r,t)=>{"use strict";t.d(r,{M:()=>s});let s=e=>{let r=e.CommentsReceived.length,t=e.CommentsReceived.reduce((e,r)=>e+(r.rating?.score||0),0);return{id:e.id,email:e.email,username:e.username,image:e.image,description:e.description,eventsCreated:e.EventsCreated,eventsJoined:e.EventsJoined.map(({event:e})=>({...e,creator:e.user})),tasks:e.Tasks,comments:e.CommentsReceived,score:r>0?t/r:0}}},49755:(e,r,t)=>{"use strict";t.d(r,{S:()=>i,h:()=>s});let s=(e,r)=>{let t=e.get(r);return"string"==typeof t?t.trim():""},i=(e,r)=>{let t=e.get(r);return t instanceof File?t:null}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[87,895,671,103,512,500,899,321],()=>t(39298));module.exports=s})();