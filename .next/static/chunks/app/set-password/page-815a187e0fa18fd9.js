(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6837],{8484:(e,s,a)=>{Promise.resolve().then(a.bind(a,589)),Promise.resolve().then(a.bind(a,9790))},589:(e,s,a)=>{"use strict";a.d(s,{default:()=>f});var r=a(5155),t=a(5828);let i=(0,t.createServerReference)("7faaecf046cb5b8d941bfcfad4c2bd225f09d86dba",t.callServer,void 0,t.findSourceMapURL,"checkPassword"),o=(0,t.createServerReference)("7ff9d91c13361dc3a4dd24a54556883017b4825aa1",t.callServer,void 0,t.findSourceMapURL,"updatePassword");var n=a(2544),l=a(1108),d=a(7188),u=a(7490),c=a(4822),m=a(6046),p=a(2115),g=a(814),v=a(1909);function f(e){var s,a,t,f;let{id:b,isUpdate:w}=e,{update:z,data:h}=(0,c.wV)(),y=(0,m.useRouter)(),[x,j]=(0,p.useTransition)(),[P,k]=(0,p.useState)(!w),[N,L]=(0,p.useState)({password:{message:"",value:!1},oldPassword:{message:"",value:!1}}),S=async e=>{if(!e){L({...N,oldPassword:{message:"Mot de passe manquant",value:!0}}),k(!1);return}j(async()=>{if(!(null==h?void 0:h.user.email)){L(e=>({...e,oldPassword:{message:"Utilisateur non connecte",value:!0}}));return}try{l.$w.safeParse({password:e}),await i({inputPassword:e,email:h.user.email})?(k(!0),L({password:{message:"",value:!1},oldPassword:{message:"",value:!1}})):(L(e=>({...e,oldPassword:{message:"Ancien mot de passe incorrect",value:!0}})),k(!1))}catch(e){console.error("Error checking old password:",e),L(e=>({...e,oldPassword:{message:"Erreur lors de la v\xe9rification",value:!0}}))}})},E=async e=>{e.preventDefault(),L({password:{message:"",value:!1},oldPassword:{message:"",value:!1}}),P||L({...N,oldPassword:{message:"Mot de passe manquant",value:!0}});let s=new FormData(e.currentTarget),a=(0,d.h)(s,"password");if(a!==(0,d.h)(s,"confirmPassword")){L({...N,password:{message:"Les mots de passe ne correspondent pas",value:!0}});return}try{l.$w.parse({password:a}),j(async()=>{let e=await o(s);(null==e?void 0:e.ok)?(await z({hasPassword:!0}),y.push("/profile"),g.o.success("Mot de passe modifi\xe9")):L({...N,password:{message:null==e?void 0:e.message,value:!0}})})}catch(s){let e=(0,n.H)(s);console.log({errorHandled:e}),L({password:{message:e.message,value:!0},oldPassword:{message:"",value:!1}})}};return(0,r.jsxs)("form",{className:"primary-form",onSubmit:E,children:[(0,r.jsx)("input",{type:"hidden",name:"id",value:b}),w&&(0,r.jsx)(u.pd,{className:"primary-input",autoFocus:w,onBlur:e=>S(e.target.value),required:!0,label:"Ancien mot de passe",type:"password",name:"oldPassword",placeholder:"Mot de passe",disabled:x,autoComplete:"current-password",success:{message:"Mot de passe v\xe9rifi\xe9",value:P},error:{message:null===(s=N.oldPassword)||void 0===s?void 0:s.message,value:null===(a=N.oldPassword)||void 0===a?void 0:a.value}}),(0,r.jsx)(u.yA,{autoFocus:!w,regexp:{message:l.Ug,pattern:l.jk},label:"Nouveau mot de passe",className:"primary-input",name:"password",placeholder:"Nouveau mot de passe",disabled:!P}),(0,r.jsx)(u.yA,{disabled:!P,className:"primary-input",label:"Confirmer le mot de passe",name:"confirmPassword",placeholder:"Confirmer le mot de passe",error:{message:null===(t=N.password)||void 0===t?void 0:t.message,value:null===(f=N.password)||void 0===f?void 0:f.value}}),(0,r.jsx)(v.A,{type:"submit",disabled:x||!P,children:w?"Modifier mot de passe":"Cr\xe9er un mot de passe"})]})}},9790:(e,s,a)=>{"use strict";a.d(s,{default:()=>i});var r=a(5155),t=a(2115);function i(e){let{children:s}=e;return(0,t.useEffect)(()=>(document.body.classList.add("no-scroll"),()=>{document.body.classList.remove("no-scroll")}),[]),(0,r.jsx)("div",{className:"no-scrollbar pt-[100px] fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center overflow-y-scroll",children:s})}},1909:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});var r=a(5155);function t(e){let{onClick:s,width:a,children:t,type:i}=e;return(0,r.jsx)("button",{type:i||"button",style:{width:a||"fit-content"},onClick:s,className:"inline-flex items-center justify-center px-4 py-1 border-2 text-lg rounded-lg bg-light-yellow text-dark-bg font-bold border-dark-bg hover:shadow-lg  transition-transform duration-300 ease-in-out ",children:t})}a(2115)},2544:(e,s,a)=>{"use strict";a.d(s,{H:()=>i});class r extends Error{constructor(e,s){super(e),this.name=this.constructor.name,this.ok=!1,this.message=e,this.errors=s}}var t=a(3415);function i(e){if(e instanceof t.G){let s=e.errors.map(e=>{let{message:s,path:a}=e;return{message:s,path:a}});return new r(s.map(e=>e.message).join(", "),s)}return new r("Une erreur est survenue")}},1108:(e,s,a)=>{"use strict";a.d(s,{$w:()=>n,Ug:()=>o,Wo:()=>d,jk:()=>i,q8:()=>u,y4:()=>t});var r=a(3415);let t=r.z.object({email:r.z.string().email({message:"Veuillez utiliser une adresse e-mail valide"})}),i=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[#@$!%*?&])[A-Za-z\d#@$!%*?&]{8,30}$/,o="8 caract\xe8res, une majuscule, une minuscule, un chiffre et un caract\xe8re sp\xe9cial, ' \" _ - ne sont pas autoris\xe9s",n=r.z.object({password:r.z.string().min(8,{message:"Le mot de passe doit \xeatre de 8 caract\xe8res minimum"}).max(30,{message:"Le mot de passe doit \xeatre de 30 caract\xe8res maximum"}).regex(i,{message:o})});r.z.object({email:r.z.string().email({message:"Veuillez utiliser une adresse e-mail valide"})});let l=r.z.object({url:r.z.string().url(),lat:r.z.number(),lng:r.z.number(),formattedAddress:r.z.string(),vicinity:r.z.string()}),d=r.z.object({categoryId:r.z.string(),title:r.z.string().max(100,{message:"Le titre doit \xeatre de 100 caract\xe8res maximum"}),description:r.z.string().min(30,{message:"Il faut un peu de l'inspiration pour cette description!"}).max(1e3,{message:"La description doit \xeatre de 1000 caract\xe8res maximum"}),eventStart:r.z.date().refine(e=>{let s=new Date;return!isNaN(e.getTime())&&e>=s},{message:"La date doit \xeatre valide et ne peut pas \xeatre dans le pass\xe9"}),eventEnd:r.z.date().nullable().refine(e=>{if(!e)return!0;let s=new Date;return!isNaN(e.getTime())&&e>=s},{message:"La date doit \xeatre valide et ne peut pas \xeatre dans le pass\xe9"}),isPublic:r.z.boolean(),participants:r.z.array(r.z.string()),address:l,image:r.z.instanceof(File)});r.z.string().regex(new RegExp("^(".concat("sport|education|language|city tours|air libre|autres",")$")),{message:"Titre invalide"});let u=r.z.object({username:r.z.string().max(30,"Le nom d'utilisateur doit comporter 30 caract\xe8res ou moins").optional(),image:r.z.union([r.z.instanceof(File).refine(e=>e.size<=2097152,{message:"La taille de l'image doit \xeatre de 2 Mo ou moins"}),r.z.null(),r.z.undefined()]).optional(),description:r.z.string().max(1e3,"La description doit comporter 1000 caract\xe8res ou moins").optional(),oldImage:r.z.string().optional()}),c=r.z.object({id:r.z.string(),email:r.z.string().email().nullable(),username:r.z.string().nullable(),image:r.z.string().nullable(),description:r.z.string().nullable(),_count:r.z.object({Ratings:r.z.number(),EventsCreated:r.z.number()})});r.z.array(c)},7188:(e,s,a)=>{"use strict";a.d(s,{S:()=>t,h:()=>r});let r=(e,s)=>{let a=e.get(s);return"string"==typeof a?a.trim():""},t=(e,s)=>{let a=e.get(s);return a instanceof File?a:null}}},e=>{var s=s=>e(e.s=s);e.O(0,[7261,815,814,3240,4822,8441,1517,7358],()=>s(8484)),_N_E=e.O()}]);
//# sourceMappingURL=page-815a187e0fa18fd9.js.map